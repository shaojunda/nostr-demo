<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostr Demo - Áã¨Á´ãÁâàÊú¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 500;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b8daff;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .user-info strong {
            color: #667eea;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e1e1;
        }
        
        .tab {
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #667eea;
            background: #f8f9fa;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .article-item {
            border: 1px solid #e1e1e1;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 15px;
            background: #fafafa;
        }
        
        .article-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .article-content {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .article-meta {
            font-size: 0.9em;
            color: #999;
            margin-bottom: 15px;
        }
        
        .article-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .article-actions button {
            background: #6c757d;
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .article-actions button.active {
            background: #667eea;
        }
        
        .relay-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #e1e1e1;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .relay-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .relay-status.connected {
            background: #28a745;
        }
        
        .relay-status.disconnected {
            background: #dc3545;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .cdn-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        
        .cdn-info h3 {
            color: #007bff;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .section {
                padding: 20px;
            }
            
            .article-actions {
                flex-direction: column;
            }
            
            .article-actions button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Nostr Demo</h1>
            <p>Âéª‰∏≠ÂøÉÂåñÁ§æ‰∫§ÂçèËÆÆÊºîÁ§∫Â∫îÁî® - Áã¨Á´ãÁâàÊú¨</p>
        </div>
        
        <div class="cdn-info">
            <h3>üì¶ ÈÄöËøá CDN Âä†ËΩΩ nostr-tools</h3>
            <p>Ê≠§ÁâàÊú¨ÈÄöËøá CDN Âä†ËΩΩ nostr-tools Â∫ìÔºåÊó†ÈúÄÊú¨Âú∞ÂÆâË£Ö‰æùËµñÔºåÂèØÁõ¥Êé•Âú®ÊµèËßàÂô®‰∏≠ËøêË°å</p>
        </div>
        
        <div id="app">
            <div class="loading">Ê≠£Âú®Âä†ËΩΩ nostr-tools Â∫ì...</div>
        </div>
        
        <div id="status-message" class="status"></div>
    </div>

    <!-- ÈÄöËøá CDN Âä†ËΩΩ nostr-tools -->
    <script src="https://unpkg.com/nostr-tools@2.7.0/lib/nostr.bundle.js"></script>
    <script type="module">
        // ‰ΩøÁî®ÂÖ®Â±ÄÂèòÈáèÊñπÂºè
        const { 
            SimplePool, 
            getEventHash, 
            getSignature,
            generatePrivateKey,
            getPublicKey,
            nip19,
            validateEvent,
            verifySignature
        } = window.NostrTools;

        // NostrClient Á±ª
        class NostrClient {
            constructor() {
                this.relays = [
                    'wss://relay.damus.io',
                    'wss://nos.lol',
                    'wss://relay.snort.social',
                    'wss://eden.nostr.land'
                ];
                
                this.pool = new SimplePool();
                this.privateKey = null;
                this.publicKey = null;
                this.connectionStatus = new Map();
                
                this.eventKinds = {
                    METADATA: 0,
                    TEXT_NOTE: 1,
                    CONTACT_LIST: 3,
                    REACTION: 7,
                    COMMENT: 1111,
                    LONG_FORM: 30023,
                    BOOKMARK: 10003
                };
                
                console.log('NostrClient initialized with CDN nostr-tools');
            }

            async createAccount(name = '', about = '') {
                try {
                    const privateKey = generatePrivateKey();
                    const publicKey = getPublicKey(privateKey);
                    const npub = nip19.npubEncode(publicKey);
                    const nsec = nip19.nsecEncode(privateKey);
                    
                    this.privateKey = privateKey;
                    this.publicKey = publicKey;
                    
                    if (name || about) {
                        await this.publishUserMetadata(name, about);
                    }
                    
                    console.log('Ë¥¶Âè∑ÂàõÂª∫ÊàêÂäü:', { npub, publicKey: publicKey.substring(0, 16) + '...' });
                    
                    return {
                        privateKey,
                        publicKey,
                        npub,
                        nsec,
                        name,
                        about
                    };
                } catch (error) {
                    console.error('ÂàõÂª∫Ë¥¶Âè∑Â§±Ë¥•:', error);
                    throw error;
                }
            }

            async importAccount(nsec) {
                try {
                    const decoded = nip19.decode(nsec);
                    if (decoded.type !== 'nsec') {
                        throw new Error('Êó†ÊïàÁöÑ nsec Ê†ºÂºè');
                    }
                    
                    const privateKey = decoded.data;
                    const publicKey = getPublicKey(privateKey);
                    const npub = nip19.npubEncode(publicKey);
                    
                    this.privateKey = privateKey;
                    this.publicKey = publicKey;
                    
                    const metadata = await this.getUserMetadata(publicKey);
                    
                    console.log('Ë¥¶Âè∑ÂØºÂÖ•ÊàêÂäü:', { npub, publicKey: publicKey.substring(0, 16) + '...' });
                    
                    return {
                        privateKey,
                        publicKey,
                        npub,
                        nsec,
                        name: metadata?.name || '',
                        about: metadata?.about || ''
                    };
                } catch (error) {
                    console.error('ÂØºÂÖ•Ë¥¶Âè∑Â§±Ë¥•:', error);
                    throw error;
                }
            }

            async initializeRelays() {
                console.log('Ê≠£Âú®ÂàùÂßãÂåñ‰∏≠ÁªßËøûÊé•...');
                
                const connectionPromises = this.relays.map(async (relay) => {
                    try {
                        await this.testRelayConnection(relay);
                        this.connectionStatus.set(relay, 'connected');
                        console.log(`‚úÖ ‰∏≠ÁªßËøûÊé•ÊàêÂäü: ${relay}`);
                    } catch (error) {
                        this.connectionStatus.set(relay, 'failed');
                        console.error(`‚ùå ‰∏≠ÁªßËøûÊé•Â§±Ë¥•: ${relay}`, error.message);
                    }
                });
                
                await Promise.allSettled(connectionPromises);
                
                const connectedCount = Array.from(this.connectionStatus.values()).filter(status => status === 'connected').length;
                console.log(`‰∏≠ÁªßÂàùÂßãÂåñÂÆåÊàê: ${connectedCount}/${this.relays.length} ‰∏™‰∏≠ÁªßËøûÊé•ÊàêÂäü`);
            }

            async testRelayConnection(relayUrl) {
                return new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        reject(new Error('ËøûÊé•Ë∂ÖÊó∂'));
                    }, 5000);
                    
                    try {
                        const ws = new WebSocket(relayUrl);
                        
                        ws.onopen = () => {
                            clearTimeout(timeout);
                            ws.close();
                            resolve();
                        };
                        
                        ws.onerror = (error) => {
                            clearTimeout(timeout);
                            reject(error);
                        };
                        
                    } catch (error) {
                        clearTimeout(timeout);
                        reject(error);
                    }
                });
            }

            createEvent(kind, content, tags = []) {
                if (!this.privateKey || !this.publicKey) {
                    throw new Error('Áî®Êà∑Êú™ËÆæÁΩÆÔºåÊó†Ê≥ïÂàõÂª∫‰∫ã‰ª∂');
                }
                
                const event = {
                    kind,
                    content,
                    tags,
                    created_at: Math.floor(Date.now() / 1000),
                    pubkey: this.publicKey
                };
                
                event.id = getEventHash(event);
                event.sig = getSignature(event, this.privateKey);
                
                const isValid = validateEvent(event);
                if (!isValid) {
                    throw new Error('‰∫ã‰ª∂È™åËØÅÂ§±Ë¥•');
                }
                
                const isSignatureValid = verifySignature(event);
                if (!isSignatureValid) {
                    throw new Error('‰∫ã‰ª∂Á≠æÂêçÈ™åËØÅÂ§±Ë¥•');
                }
                
                console.log('‰∫ã‰ª∂ÂàõÂª∫ÊàêÂäü:', { kind, id: event.id.substring(0, 16) + '...' });
                return event;
            }

            async publishEvent(event) {
                if (!event.id || !event.sig) {
                    throw new Error('‰∫ã‰ª∂Êú™Ê≠£Á°ÆÁ≠æÂêç');
                }
                
                console.log('Ê≠£Âú®ÂèëÂ∏É‰∫ã‰ª∂:', { 
                    kind: event.kind, 
                    id: event.id.substring(0, 16) + '...',
                    relays: this.relays.length 
                });
                
                const pubs = this.pool.publish(this.relays, event);
                
                return new Promise((resolve, reject) => {
                    let successCount = 0;
                    let errorCount = 0;
                    const results = [];
                    
                    pubs.on('ok', (relayUrl) => {
                        successCount++;
                        results.push({ relay: relayUrl, status: 'ok' });
                        console.log(`‚úÖ ‰∫ã‰ª∂ÂèëÂ∏ÉÊàêÂäü: ${relayUrl}`);
                        
                        if (successCount === 1) {
                            resolve({ event, results });
                        }
                    });
                    
                    pubs.on('failed', (relayUrl, reason) => {
                        errorCount++;
                        results.push({ relay: relayUrl, status: 'failed', reason });
                        console.error(`‚ùå ‰∫ã‰ª∂ÂèëÂ∏ÉÂ§±Ë¥•: ${relayUrl}`, reason);
                        
                        if (errorCount === this.relays.length) {
                            reject(new Error(`ÊâÄÊúâ‰∏≠ÁªßÂèëÂ∏ÉÂ§±Ë¥•: ${JSON.stringify(results)}`));
                        }
                    });
                    
                    setTimeout(() => {
                        if (successCount === 0) {
                            reject(new Error('ÂèëÂ∏ÉË∂ÖÊó∂'));
                        }
                    }, 10000);
                });
            }

            async queryEvents(filter, timeout = 5000) {
                console.log('Ê≠£Âú®Êü•ËØ¢‰∫ã‰ª∂:', filter);
                const events = await this.pool.list(this.relays, [filter], { timeout });
                console.log(`Êü•ËØ¢ÂÆåÊàê: ÊâæÂà∞ ${events.length} ‰∏™‰∫ã‰ª∂`);
                return events;
            }

            async publishUserMetadata(name, about, picture = '') {
                const metadata = { name, about, picture };
                const event = this.createEvent(this.eventKinds.METADATA, JSON.stringify(metadata));
                return await this.publishEvent(event);
            }

            async getUserMetadata(pubkey) {
                try {
                    const events = await this.queryEvents({
                        kinds: [this.eventKinds.METADATA],
                        authors: [pubkey],
                        limit: 1
                    });
                    
                    if (events.length > 0) {
                        const metadata = JSON.parse(events[0].content);
                        return { ...metadata, pubkey, lastUpdated: events[0].created_at };
                    }
                    
                    return null;
                } catch (error) {
                    console.error('Ëé∑ÂèñÁî®Êà∑ÂÖÉÊï∞ÊçÆÂ§±Ë¥•:', error);
                    return null;
                }
            }

            async publishArticle(title, content) {
                const dTag = 'article_' + Date.now() + '_' + Math.random().toString(36).substring(2, 11);
                const event = this.createEvent(
                    this.eventKinds.LONG_FORM,
                    content,
                    [
                        ['d', dTag],
                        ['title', title],
                        ['published_at', Math.floor(Date.now() / 1000).toString()],
                        ['alt', `ËøôÊòØ‰∏ÄÁØáÈïøÊñáÁ´†: ${title}`]
                    ]
                );
                
                return await this.publishEvent(event);
            }

            async likeArticle(articleId, authorPubkey) {
                const event = this.createEvent(
                    this.eventKinds.REACTION,
                    '+',
                    [
                        ['e', articleId, '', '', authorPubkey],
                        ['p', authorPubkey]
                    ]
                );
                
                return await this.publishEvent(event);
            }

            async bookmarkArticle(articleId, title = '') {
                const event = this.createEvent(
                    this.eventKinds.BOOKMARK,
                    '',
                    [
                        ['e', articleId, ''],
                        ['title', title || 'ÊàëÁöÑÊî∂Ëóè']
                    ]
                );
                
                return await this.publishEvent(event);
            }

            async followAuthor(authorPubkey, alias = '') {
                const currentFollows = await this.getCurrentFollowList();
                
                const isAlreadyFollowing = currentFollows.some(tag =>
                    tag[0] === 'p' && tag[1] === authorPubkey
                );
                
                if (isAlreadyFollowing) {
                    throw new Error('Â∑≤ÁªèÂÖ≥Ê≥®ËøáËØ•‰ΩúËÄÖ');
                }
                
                const newFollowList = [
                    ...currentFollows,
                    ['p', authorPubkey, '', alias]
                ];
                
                const event = this.createEvent(this.eventKinds.CONTACT_LIST, '', newFollowList);
                return await this.publishEvent(event);
            }

            async getCurrentFollowList() {
                try {
                    const events = await this.queryEvents({
                        kinds: [this.eventKinds.CONTACT_LIST],
                        authors: [this.publicKey],
                        limit: 1
                    });
                    
                    if (events.length > 0) {
                        return events[0].tags.filter(tag => tag[0] === 'p');
                    }
                    
                    return [];
                } catch (error) {
                    console.error('Ëé∑ÂèñÂÖ≥Ê≥®ÂàóË°®Â§±Ë¥•:', error);
                    return [];
                }
            }

            async commentOnArticle(articleId, authorPubkey, content) {
                const articleATag = `30023:${authorPubkey}:${articleId.substring(0, 16)}`;
                const event = this.createEvent(
                    this.eventKinds.COMMENT,
                    content,
                    [
                        ['A', articleATag],
                        ['K', '30023'],
                        ['P', authorPubkey]
                    ]
                );
                
                return await this.publishEvent(event);
            }

            async getTimeline(limit = 20) {
                try {
                    console.log('Ê≠£Âú®Ëé∑ÂèñÊó∂Èó¥Á∫ø...');
                    
                    const followList = await this.getCurrentFollowList();
                    const followedAuthors = followList.map(tag => tag[1]);
                    followedAuthors.push(this.publicKey);
                    
                    const articles = await this.queryEvents({
                        kinds: [this.eventKinds.LONG_FORM],
                        authors: followedAuthors.length > 0 ? followedAuthors : undefined,
                        limit
                    });
                    
                    articles.sort((a, b) => b.created_at - a.created_at);
                    
                    console.log(`Êó∂Èó¥Á∫øËé∑ÂèñÂÆåÊàê: ${articles.length} ÁØáÊñáÁ´†`);
                    return articles;
                } catch (error) {
                    console.error('Ëé∑ÂèñÊó∂Èó¥Á∫øÂ§±Ë¥•:', error);
                    return [];
                }
            }

            async addRelay(relayUrl) {
                if (this.relays.includes(relayUrl)) {
                    throw new Error('ËØ•‰∏≠ÁªßÂ∑≤Â≠òÂú®');
                }
                
                await this.testRelayConnection(relayUrl);
                this.relays.push(relayUrl);
                this.connectionStatus.set(relayUrl, 'connected');
                
                console.log('‰∏≠ÁªßÊ∑ªÂä†ÊàêÂäü:', relayUrl);
            }

            getRelays() {
                return this.relays.map(url => ({
                    url,
                    connected: this.connectionStatus.get(url) === 'connected'
                }));
            }

            getTagValue(tags, tagName) {
                const tag = tags.find(t => t[0] === tagName);
                return tag ? tag[1] : null;
            }

            truncateKey(key, length = 16) {
                if (!key) return '';
                return key.length > length ? key.substring(0, length) + '...' : key;
            }

            formatTime(timestamp) {
                const date = new Date(timestamp * 1000);
                return date.toLocaleString('zh-CN');
            }

            destroy() {
                this.pool.close(this.relays);
                console.log('NostrClient Â∑≤ÈîÄÊØÅ');
            }
        }

        // Â∫îÁî®Á±ª
        class NostrApp {
            constructor() {
                this.client = new NostrClient();
                this.currentSection = 'auth';
                this.articles = [];
            }

            async init() {
                this.createUI();
                this.bindEvents();
                
                const savedUser = localStorage.getItem('nostr-user');
                if (savedUser) {
                    const user = JSON.parse(savedUser);
                    this.client.privateKey = user.privateKey;
                    this.client.publicKey = user.publicKey;
                    this.showUserInfo(user);
                    this.showSection('main');
                }
                
                await this.client.initializeRelays();
                this.updateRelayList();
            }

            createUI() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <div id="auth-section" class="section" style="display: ${this.currentSection === 'auth' ? 'block' : 'none'};">
                        <h2>Ê¨¢Ëøé‰ΩøÁî® Nostr Demo</h2>
                        
                        <div class="tabs">
                            <button class="tab active" data-tab="create">ÂàõÂª∫Ë¥¶Âè∑</button>
                            <button class="tab" data-tab="import">ÂØºÂÖ•Ë¥¶Âè∑</button>
                        </div>
                        
                        <div id="create-tab" class="tab-content active">
                            <div class="form-group">
                                <label for="userName">Áî®Êà∑Âêç:</label>
                                <input type="text" id="userName" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç">
                            </div>
                            
                            <div class="form-group">
                                <label for="userAbout">‰∏™‰∫∫ÁÆÄ‰ªã:</label>
                                <textarea id="userAbout" placeholder="ËØ∑ËæìÂÖ•‰∏™‰∫∫ÁÆÄ‰ªã"></textarea>
                            </div>
                            
                            <button id="createAccount">ÂàõÂª∫Ë¥¶Âè∑</button>
                        </div>
                        
                        <div id="import-tab" class="tab-content">
                            <div class="form-group">
                                <label for="nsecInput">ÁßÅÈí• (nsec):</label>
                                <input type="password" id="nsecInput" placeholder="ËØ∑ËæìÂÖ• nsec ÁßÅÈí•">
                            </div>
                            
                            <button id="importAccount">ÂØºÂÖ•Ë¥¶Âè∑</button>
                        </div>
                    </div>
                    
                    <div id="main-section" class="section" style="display: ${this.currentSection === 'main' ? 'block' : 'none'};">
                        <div id="user-info" class="user-info">
                            <strong>Áî®Êà∑:</strong> <span id="user-name"></span> 
                            (<span id="user-pubkey"></span>)
                            <br>
                            <strong>ÁÆÄ‰ªã:</strong> <span id="user-about"></span>
                        </div>
                        
                        <div class="tabs">
                            <button class="tab active" data-tab="timeline">Êó∂Èó¥Á∫ø</button>
                            <button class="tab" data-tab="publish">ÂèëÂ∏ÉÊñáÁ´†</button>
                            <button class="tab" data-tab="relays">‰∏≠ÁªßÁÆ°ÁêÜ</button>
                        </div>
                        
                        <div id="timeline-tab" class="tab-content active">
                            <div style="margin-bottom: 20px;">
                                <button id="refreshTimeline">Âà∑Êñ∞Êó∂Èó¥Á∫ø</button>
                            </div>
                            
                            <div id="timeline-content">
                                <div class="loading">ÁÇπÂáªÂà∑Êñ∞Êó∂Èó¥Á∫øËé∑ÂèñÂÜÖÂÆπ...</div>
                            </div>
                        </div>
                        
                        <div id="publish-tab" class="tab-content">
                            <div class="form-group">
                                <label for="articleTitle">ÊñáÁ´†Ê†áÈ¢ò:</label>
                                <input type="text" id="articleTitle" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò">
                            </div>
                            
                            <div class="form-group">
                                <label for="articleContent">ÊñáÁ´†ÂÜÖÂÆπ:</label>
                                <textarea id="articleContent" placeholder="ËØ∑ËæìÂÖ•ÊñáÁ´†ÂÜÖÂÆπ" rows="10"></textarea>
                            </div>
                            
                            <button id="publishArticle">ÂèëÂ∏ÉÊñáÁ´†</button>
                        </div>
                        
                        <div id="relays-tab" class="tab-content">
                            <div class="form-group">
                                <label for="relayUrl">‰∏≠ÁªßÂú∞ÂùÄ:</label>
                                <input type="url" id="relayUrl" placeholder="wss://relay.example.com">
                            </div>
                            
                            <button id="addRelay">Ê∑ªÂä†‰∏≠Áªß</button>
                            
                            <div id="relay-list">
                                <h3>‰∏≠ÁªßÂàóË°®</h3>
                                <div id="relay-items"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            bindEvents() {
                // Ê†áÁ≠æÂàáÊç¢
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tab')) {
                        this.switchTab(e.target.dataset.tab);
                    }
                });

                // ÂàõÂª∫Ë¥¶Âè∑
                document.getElementById('createAccount').addEventListener('click', async () => {
                    await this.handleCreateAccount();
                });

                // ÂØºÂÖ•Ë¥¶Âè∑
                document.getElementById('importAccount').addEventListener('click', async () => {
                    await this.handleImportAccount();
                });

                // ÂèëÂ∏ÉÊñáÁ´†
                document.getElementById('publishArticle').addEventListener('click', async () => {
                    await this.handlePublishArticle();
                });

                // Âà∑Êñ∞Êó∂Èó¥Á∫ø
                document.getElementById('refreshTimeline').addEventListener('click', async () => {
                    await this.handleRefreshTimeline();
                });

                // Ê∑ªÂä†‰∏≠Áªß
                document.getElementById('addRelay').addEventListener('click', async () => {
                    await this.handleAddRelay();
                });

                // ÊñáÁ´†Êìç‰Ωú
                document.addEventListener('click', async (e) => {
                    if (e.target.classList.contains('like-btn')) {
                        await this.handleLikeArticle(e.target);
                    }
                    if (e.target.classList.contains('bookmark-btn')) {
                        await this.handleBookmarkArticle(e.target);
                    }
                    if (e.target.classList.contains('follow-btn')) {
                        await this.handleFollowAuthor(e.target);
                    }
                    if (e.target.classList.contains('comment-btn')) {
                        await this.handleCommentArticle(e.target);
                    }
                });
            }

            switchTab(tabType) {
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.tab === tabType) {
                        tab.classList.add('active');
                    }
                });
                
                const contents = document.querySelectorAll('.tab-content');
                contents.forEach(content => {
                    content.classList.remove('active');
                });
                
                const activeContent = document.getElementById(tabType + '-tab');
                if (activeContent) {
                    activeContent.classList.add('active');
                }
            }

            showSection(sectionName) {
                const sections = ['auth-section', 'main-section'];
                sections.forEach(section => {
                    const element = document.getElementById(section);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
                const activeSection = document.getElementById(sectionName + '-section');
                if (activeSection) {
                    activeSection.style.display = 'block';
                }
                
                this.currentSection = sectionName;
            }

            showUserInfo(user) {
                document.getElementById('user-name').textContent = user.name || 'Êú™ËÆæÁΩÆ';
                document.getElementById('user-pubkey').textContent = this.client.truncateKey(user.publicKey);
                document.getElementById('user-about').textContent = user.about || 'Êú™ËÆæÁΩÆ';
            }

            async handleCreateAccount() {
                try {
                    this.showStatus('ÂàõÂª∫Ë¥¶Âè∑‰∏≠...', 'info');
                    
                    const name = document.getElementById('userName').value;
                    const about = document.getElementById('userAbout').value;
                    
                    const user = await this.client.createAccount(name, about);
                    
                    localStorage.setItem('nostr-user', JSON.stringify(user));
                    
                    this.showStatus('Ë¥¶Âè∑ÂàõÂª∫ÊàêÂäüÔºÅ', 'success');
                    this.showUserInfo(user);
                    this.showSection('main');
                    
                } catch (error) {
                    this.showStatus('ÂàõÂª∫Ë¥¶Âè∑Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleImportAccount() {
                try {
                    this.showStatus('ÂØºÂÖ•Ë¥¶Âè∑‰∏≠...', 'info');
                    
                    const nsec = document.getElementById('nsecInput').value;
                    const user = await this.client.importAccount(nsec);
                    
                    localStorage.setItem('nostr-user', JSON.stringify(user));
                    
                    this.showStatus('Ë¥¶Âè∑ÂØºÂÖ•ÊàêÂäüÔºÅ', 'success');
                    this.showUserInfo(user);
                    this.showSection('main');
                    
                } catch (error) {
                    this.showStatus('ÂØºÂÖ•Ë¥¶Âè∑Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handlePublishArticle() {
                try {
                    this.showStatus('ÂèëÂ∏ÉÊñáÁ´†‰∏≠...', 'info');
                    
                    const title = document.getElementById('articleTitle').value;
                    const content = document.getElementById('articleContent').value;
                    
                    if (!title || !content) {
                        this.showStatus('ËØ∑Â°´ÂÜôÊñáÁ´†Ê†áÈ¢òÂíåÂÜÖÂÆπ', 'error');
                        return;
                    }
                    
                    const result = await this.client.publishArticle(title, content);
                    
                    this.showStatus('ÊñáÁ´†ÂèëÂ∏ÉÊàêÂäüÔºÅ', 'success');
                    
                    // Ê∏ÖÁ©∫Ë°®Âçï
                    document.getElementById('articleTitle').value = '';
                    document.getElementById('articleContent').value = '';
                    
                    // Ê∑ªÂä†Âà∞Êú¨Âú∞ÂàóË°®
                    this.articles.unshift(result.event);
                    this.updateTimeline();
                    
                } catch (error) {
                    this.showStatus('ÂèëÂ∏ÉÊñáÁ´†Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleRefreshTimeline() {
                try {
                    this.showStatus('Âà∑Êñ∞Êó∂Èó¥Á∫ø‰∏≠...', 'info');
                    
                    const articles = await this.client.getTimeline();
                    this.articles = articles;
                    this.updateTimeline();
                    
                    this.showStatus('Êó∂Èó¥Á∫øÂ∑≤Êõ¥Êñ∞', 'success');
                } catch (error) {
                    this.showStatus('Âà∑Êñ∞Êó∂Èó¥Á∫øÂ§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleAddRelay() {
                try {
                    const relayUrl = document.getElementById('relayUrl').value;
                    
                    if (!relayUrl) {
                        this.showStatus('ËØ∑ËæìÂÖ•‰∏≠ÁªßÂú∞ÂùÄ', 'error');
                        return;
                    }
                    
                    this.showStatus('ËøûÊé•‰∏≠Áªß‰∏≠...', 'info');
                    
                    await this.client.addRelay(relayUrl);
                    
                    this.showStatus('‰∏≠ÁªßËøûÊé•ÊàêÂäüÔºÅ', 'success');
                    this.updateRelayList();
                    
                    document.getElementById('relayUrl').value = '';
                    
                } catch (error) {
                    this.showStatus('ËøûÊé•‰∏≠ÁªßÂ§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleLikeArticle(button) {
                try {
                    const articleId = button.dataset.articleId;
                    const authorPubkey = button.dataset.authorPubkey;
                    
                    await this.client.likeArticle(articleId, authorPubkey);
                    
                    button.classList.add('active');
                    button.textContent = 'Â∑≤ÁÇπËµû';
                    
                    this.showStatus('ÁÇπËµûÊàêÂäüÔºÅ', 'success');
                    
                } catch (error) {
                    this.showStatus('ÁÇπËµûÂ§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleBookmarkArticle(button) {
                try {
                    const articleId = button.dataset.articleId;
                    const title = button.dataset.title;
                    
                    await this.client.bookmarkArticle(articleId, title);
                    
                    button.classList.add('active');
                    button.textContent = 'Â∑≤Êî∂Ëóè';
                    
                    this.showStatus('Êî∂ËóèÊàêÂäüÔºÅ', 'success');
                    
                } catch (error) {
                    this.showStatus('Êî∂ËóèÂ§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleFollowAuthor(button) {
                try {
                    const authorPubkey = button.dataset.authorPubkey;
                    const authorName = button.dataset.authorName;
                    
                    await this.client.followAuthor(authorPubkey, authorName);
                    
                    button.classList.add('active');
                    button.textContent = 'Â∑≤ÂÖ≥Ê≥®';
                    
                    this.showStatus('ÂÖ≥Ê≥®ÊàêÂäüÔºÅ', 'success');
                    
                } catch (error) {
                    this.showStatus('ÂÖ≥Ê≥®Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            async handleCommentArticle(button) {
                try {
                    const articleId = button.dataset.articleId;
                    const authorPubkey = button.dataset.authorPubkey;
                    
                    const content = prompt('ËØ∑ËæìÂÖ•ËØÑËÆ∫ÂÜÖÂÆπ:');
                    if (!content) return;
                    
                    await this.client.commentOnArticle(articleId, authorPubkey, content);
                    
                    this.showStatus('ËØÑËÆ∫ÂèëÂ∏ÉÊàêÂäüÔºÅ', 'success');
                    
                } catch (error) {
                    this.showStatus('ÂèëÂ∏ÉËØÑËÆ∫Â§±Ë¥•: ' + error.message, 'error');
                }
            }

            updateTimeline() {
                const timelineContent = document.getElementById('timeline-content');
                
                if (this.articles.length === 0) {
                    timelineContent.innerHTML = '<div class="status info">ÊöÇÊó†ÊñáÁ´†ÔºåËØ∑ÂèëÂ∏ÉÊñáÁ´†ÊàñÁÇπÂáªÂà∑Êñ∞Êó∂Èó¥Á∫ø</div>';
                    return;
                }
                
                let html = '';
                this.articles.forEach(article => {
                    const title = this.client.getTagValue(article.tags, 'title') || 'Êó†Ê†áÈ¢ò';
                    const timeStr = this.client.formatTime(article.created_at);
                    
                    html += `
                        <div class="article-item">
                            <div class="article-title">${this.escapeHtml(title)}</div>
                            <div class="article-content">${this.escapeHtml(article.content.substring(0, 200))}${article.content.length > 200 ? '...' : ''}</div>
                            <div class="article-meta">
                                ‰ΩúËÄÖ: ${this.client.truncateKey(article.pubkey)} | 
                                ÂèëÂ∏ÉÊó∂Èó¥: ${timeStr}
                            </div>
                            <div class="article-actions">
                                <button class="like-btn" data-article-id="${article.id}" data-author-pubkey="${article.pubkey}">
                                    üëç ÁÇπËµû
                                </button>
                                <button class="bookmark-btn" data-article-id="${article.id}" data-title="${this.escapeHtml(title)}">
                                    üìö Êî∂Ëóè
                                </button>
                                <button class="follow-btn" data-author-pubkey="${article.pubkey}" data-author-name="${this.client.truncateKey(article.pubkey)}">
                                    üë• ÂÖ≥Ê≥®
                                </button>
                                <button class="comment-btn" data-article-id="${article.id}" data-author-pubkey="${article.pubkey}">
                                    üí¨ ËØÑËÆ∫
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                timelineContent.innerHTML = html;
            }

            updateRelayList() {
                const relayItems = document.getElementById('relay-items');
                const relays = this.client.getRelays();
                
                let html = '';
                relays.forEach(relay => {
                    html += `
                        <div class="relay-item">
                            <div>
                                <span class="relay-status ${relay.connected ? 'connected' : 'disconnected'}"></span>
                                ${relay.url}
                            </div>
                            <div>${relay.connected ? 'Â∑≤ËøûÊé•' : 'Êú™ËøûÊé•'}</div>
                        </div>
                    `;
                });
                
                relayItems.innerHTML = html;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            showStatus(message, type) {
                const statusDiv = document.getElementById('status-message');
                statusDiv.className = `status ${type}`;
                statusDiv.textContent = message;
                statusDiv.style.display = 'block';
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        // ÂêØÂä®Â∫îÁî®
        const app = new NostrApp();
        app.init().catch(error => {
            console.error('Â∫îÁî®ÂêØÂä®Â§±Ë¥•:', error);
            document.getElementById('app').innerHTML = `
                <div class="section">
                    <div class="status error" style="display: block;">
                        Â∫îÁî®ÂêØÂä®Â§±Ë¥•: ${error.message}
                    </div>
                </div>
            `;
        });
    </script>
</body>
</html>